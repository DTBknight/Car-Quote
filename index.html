<!DOCTYPE html>
<html lang="zh-CN" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>汽车报价计算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#FF7D00',
            neutral: '#F5F7FA',
            dark: '#1D2129',
            // 二手车主题色 - 橙色主题
            usedCar: '#FF6B35',
            usedCarLight: '#FF8C42',
            usedCarDark: '#E55A2B',
            // 新能源主题色
            newEnergy: '#22C55E',
            newEnergyLight: '#4ADE80',
            newEnergyDark: '#16A34A',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    :root {
      --primary-color: #165DFF;
      --primary-color-rgb: 22, 93, 255;
      --secondary-color: #36CFC9;
      --accent-color: #FF7D00;
      
      /* 浅色主题变量 */
      --bg-primary: #ffffff;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f9fafb;
      --text-primary: #111827;
      --text-secondary: #374151;
      --text-tertiary: #6b7280;
      --border-color: #d1d5db;
      --shadow-color: rgba(0, 0, 0, 0.1);
    }
    
    /* 深色主题变量 */
    [data-theme="dark"],
    [data-theme="dark"] :root {
      --bg-primary: #1f2937;
      --bg-secondary: #111827;
      --bg-tertiary: #374151;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --text-tertiary: #9ca3af;
      --border-color: #4b5563;
      --shadow-color: rgba(0, 0, 0, 0.3);
    }
    
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 30px -5px var(--shadow-color);
      }
      .input-focus {
        @apply focus:ring-2 focus:ring-primary/20 focus:outline-none;
        border-color: var(--border-color);
      }
      .input-focus:focus {
        border-color: var(--primary-color);
      }
      .transition-custom {
        @apply transition-all duration-300 ease-in-out;
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      /* 主题切换动画 */
      .theme-transitioning {
        opacity: 0.8;
        transition: opacity 0.15s ease-in-out;
      }
      
      /* 二手车主题样式 */
      .used-car-theme .card-shadow {
        box-shadow: 0 10px 30px -5px rgba(255, 107, 53, 0.1);
      }
      .used-car-theme .input-focus {
        @apply focus:border-usedCar focus:ring-2 focus:ring-usedCar/20 focus:outline-none;
      }
      
      /* 新能源主题样式 */
      .new-energy-theme .card-shadow {
        box-shadow: 0 10px 30px -5px rgba(34, 197, 94, 0.1);
      }
      .new-energy-theme .input-focus {
        @apply focus:border-newEnergy focus:ring-2 focus:ring-newEnergy/20 focus:outline-none;
      }
      
      /* 动态主题颜色 */
      .text-primary {
        color: var(--primary-color) !important;
      }
      .bg-primary {
        background-color: var(--primary-color) !important;
      }
      .border-primary {
        border-color: var(--primary-color) !important;
      }
      .hover\:bg-primary:hover {
        background-color: var(--primary-color) !important;
      }
      .focus\:border-primary:focus {
        border-color: var(--primary-color) !important;
      }
      .focus\:ring-primary\/20:focus {
        --tw-ring-color: var(--primary-color);
        --tw-ring-opacity: 0.2;
      }
      
      /* 深色主题样式覆盖 */
      [data-theme="dark"] body {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] body.bg-gray-50 {
        background-color: var(--bg-secondary) !important;
      }
      
      /* Tailwind 暗色模式支持 */
      .dark body {
        background-color: #111827 !important;
      }
      .dark body.bg-gray-50 {
        background-color: #111827 !important;
      }
      [data-theme="dark"] .bg-white {
        background-color: var(--bg-primary) !important;
      }
      [data-theme="dark"] .bg-gray-50 {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] .bg-gray-100 {
        background-color: var(--bg-tertiary) !important;
      }
      [data-theme="dark"] input.bg-gray-50 {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] .text-dark {
        color: var(--text-primary) !important;
      }
      [data-theme="dark"] .text-gray-700 {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] .text-gray-600 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] .text-gray-500 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] .text-gray-600 {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] .text-gray-700 {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] .border-gray-200 {
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] .border-gray-300 {
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] .border-gray-100 {
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] input[type="text"],
      [data-theme="dark"] input[type="number"],
      [data-theme="dark"] select {
        background-color: var(--bg-primary) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] input[readonly] {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] .bg-gray-100 {
        background-color: var(--bg-tertiary) !important;
      }
      [data-theme="dark"] .hover\:bg-gray-200:hover {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] .hover\:bg-gray-100:hover {
        background-color: var(--bg-tertiary) !important;
      }
      [data-theme="dark"] .shadow-sm {
        box-shadow: 0 1px 2px 0 var(--shadow-color) !important;
      }
      [data-theme="dark"] .shadow-md {
        box-shadow: 0 4px 6px -1px var(--shadow-color) !important;
      }
      [data-theme="dark"] .shadow-lg {
        box-shadow: 0 10px 15px -3px var(--shadow-color) !important;
      }
      
      /* 深色主题 - 最终报价卡片样式 */
      [data-theme="dark"] .bg-primary\/10 {
        background-color: rgba(var(--primary-color-rgb), 0.15) !important;
      }
      [data-theme="dark"] .border-primary\/20 {
        border-color: rgba(var(--primary-color-rgb), 0.3) !important;
      }
      
      /* 深色主题 - 表单和卡片样式 */
      [data-theme="dark"] .bg-white {
        background-color: var(--bg-primary) !important;
      }
      [data-theme="dark"] .rounded-xl {
        background-color: var(--bg-primary) !important;
      }
      [data-theme="dark"] .border-b {
        border-bottom-color: var(--border-color) !important;
      }
      [data-theme="dark"] .pb-6 {
        border-bottom-color: var(--border-color) !important;
      }
      [data-theme="dark"] .space-y-8 > * + * {
        border-top-color: var(--border-color) !important;
      }
      [data-theme="dark"] section.border-b {
        border-bottom-color: var(--border-color) !important;
      }
      
      /* 深色主题 - 标签和文字 */
      [data-theme="dark"] label {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] .text-xl {
        color: var(--text-primary) !important;
      }
      [data-theme="dark"] .text-lg {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] .text-sm {
        color: var(--text-secondary) !important;
      }
      
      /* 深色主题 - 占位符文字 */
      [data-theme="dark"] input::placeholder {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] select::placeholder {
        color: var(--text-tertiary) !important;
      }
      
      /* 深色主题 - 选项文字 */
      [data-theme="dark"] option {
        background-color: var(--bg-primary) !important;
        color: var(--text-primary) !important;
      }
      
      /* 深色主题 - 搜索结果 */
      [data-theme="dark"] #carSearchResults {
        background-color: var(--bg-primary) !important;
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] #carSearchResults .border-b {
        border-bottom-color: var(--border-color) !important;
      }
      [data-theme="dark"] #carSearchResults .hover\:bg-gray-50:hover {
        background-color: var(--bg-secondary) !important;
      }
      
      /* 深色主题 - 单选按钮标签 */
      [data-theme="dark"] .inline-flex.items-center {
        border-color: var(--border-color) !important;
      }
      [data-theme="dark"] .inline-flex.items-center:hover {
        border-color: var(--primary-color) !important;
      }
      
      /* 深色主题 - 页脚 */
      [data-theme="dark"] footer {
        background-color: var(--bg-primary) !important;
      }
      [data-theme="dark"] footer .text-gray-500 {
        color: var(--text-secondary) !important;
      }
      
      /* 深色主题 - 结果卡片 */
      [data-theme="dark"] #resultCard {
        background-color: var(--bg-primary) !important;
      }
      [data-theme="dark"] #resultCard .border-b {
        border-bottom-color: var(--border-color) !important;
      }
      [data-theme="dark"] #resultCard .border-r {
        border-right-color: var(--border-color) !important;
      }
      [data-theme="dark"] #resultCard .border-t {
        border-top-color: var(--border-color) !important;
      }
      [data-theme="dark"] #resultCard .bg-gray-50 {
        background-color: var(--bg-secondary) !important;
      }
      [data-theme="dark"] #resultCard .bg-primary\/10 {
        background-color: rgba(var(--primary-color-rgb), 0.1) !important;
      }
      [data-theme="dark"] #resultCard .border-primary\/20 {
        border-color: rgba(var(--primary-color-rgb), 0.2) !important;
      }
      
      /* 深色主题 - 结果卡片文字 */
      [data-theme="dark"] #resultCard .text-gray-600 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] #resultCard .text-gray-500 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] #resultCard .font-medium {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] #resultCard .font-semibold {
        color: var(--text-primary) !important;
      }
      [data-theme="dark"] #resultCard .text-lg {
        color: var(--text-primary) !important;
      }
      [data-theme="dark"] #resultCard .text-primary {
        color: var(--primary-color) !important;
      }
      [data-theme="dark"] #resultCard .text-green-600 {
        color: #10b981 !important;
      }
      
      /* 深色主题 - 结果卡片所有文字元素 */
      [data-theme="dark"] #resultCard h3,
      [data-theme="dark"] #resultCard h4,
      [data-theme="dark"] #resultCard span,
      [data-theme="dark"] #resultCard div,
      [data-theme="dark"] #resultCard li {
        color: inherit !important;
      }
      
      /* 深色主题 - 结果卡片特定文字颜色 */
      [data-theme="dark"] #resultCard .text-gray-700 {
        color: var(--text-secondary) !important;
      }
      [data-theme="dark"] #resultCard .text-gray-600 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] #resultCard .text-gray-500 {
        color: var(--text-tertiary) !important;
      }
      [data-theme="dark"] #resultCard .text-sm {
        color: var(--text-tertiary) !important;
      }
      
      /* 深色主题 - 报价汇总卡片 */
      [data-theme="dark"] #resultCard .bg-gray-50 {
        background-color: var(--bg-tertiary) !important;
      }
      [data-theme="dark"] #resultCard .bg-primary\/10 {
        background-color: rgba(var(--primary-color-rgb), 0.2) !important;
      }
      [data-theme="dark"] #resultCard .border-primary\/20 {
        border-color: rgba(var(--primary-color-rgb), 0.4) !important;
      }
      
      /* 深色主题 - 报价汇总卡片增强对比度 */
      [data-theme="dark"] #resultCard .p-4.rounded-lg {
        background-color: var(--bg-tertiary) !important;
        border: 1px solid var(--border-color) !important;
      }
      [data-theme="dark"] #resultCard .bg-primary\/10.p-4.rounded-lg {
        background-color: rgba(var(--primary-color-rgb), 0.25) !important;
        border: 1px solid rgba(var(--primary-color-rgb), 0.5) !important;
      }
      
      /* 滑块和单选按钮颜色 */
      input[type="range"] {
        accent-color: var(--primary-color);
      }
      input[type="radio"] {
        accent-color: var(--primary-color);
      }
      
      /* 去掉所有数值输入框的上下调节按钮 */
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-dark min-h-screen transition-custom" id="mainBody" data-theme="light">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky top-0 z-50 transition-custom">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-calculator text-primary text-2xl"></i>
        <h1 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-dark">Quotation Calculator</h1>
      </div>
      <div class="flex items-center space-x-2">
        <button 
          id="themeToggle" 
          class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-custom"
          title="切换主题"
        >
          <i class="fa fa-sun-o text-gray-600" id="themeIcon"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 表单卡片 -->
    <div class="bg-white rounded-xl shadow-md p-6 md:p-8 mb-8">
      <form id="carQuoteForm" class="space-y-8">
        <!-- 基础信息部分 -->
        <section class="border-b border-gray-100 pb-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-info-circle text-primary mr-2"></i>基础信息
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 车型名称 -->
            <div class="space-y-2">
              <label for="carModel" class="block text-sm font-medium text-gray-700 flex items-center">
                <i class="fa fa-tag text-primary mr-2"></i>车型名称
              </label>
              <input 
                type="text" 
                id="carModel" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="例如：特斯拉 Model 3"
                required
              >
              <!-- 车型搜索结果显示 -->
              <div id="carSearchResults" class="hidden mt-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg bg-white shadow-lg">
                <!-- 动态填充搜索结果 -->
              </div>
            </div>
            
            <!-- 出口类型 -->
            <div class="space-y-2">
              <label for="carType" class="block text-sm font-medium text-gray-700 flex items-center">
                <i class="fa fa-ship text-primary mr-2"></i>出口类型
              </label>
              <select 
                id="carType" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                required
              >
                <option value="new" selected>新车</option>
                <option value="used">二手车</option>
                <option value="newEnergyTax">新能源车</option>
              </select>
            </div>
          </div>
        </section>
        
        <!-- 新车表单 (默认隐藏，选择新车时显示) -->
        <section id="newCarForm" class="hidden space-y-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-car text-primary mr-2"></i>新车报价信息
          </h3>
          
          <!-- 报价类型 -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价类型
            </label>
            <div class="flex flex-wrap gap-3">
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="EXW" class="text-primary focus:ring-primary" checked>
                <span class="ml-2">EXW</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="FOB" class="text-primary focus:ring-primary">
                <span class="ml-2">FOB</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="CIF" class="text-primary focus:ring-primary">
                <span class="ml-2">CIF</span>
              </label>
            </div>
          </div>
          
          <!-- 第一区：指导价，优惠，选装，开票价，交强险 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-tag text-primary mr-2"></i>基础价格信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 指导价 -->
              <div class="space-y-2">
                <label for="guidePrice" class="block text-sm font-medium text-gray-700">指导价 (元)</label>
                <input 
                  type="number" 
                  id="guidePrice" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入指导价"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 优惠 -->
              <div class="space-y-2">
                <label for="discount" class="block text-sm font-medium text-gray-700">优惠 (元)</label>
                <input 
                  type="number" 
                  id="discount" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入优惠金额"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 选装 -->
              <div class="space-y-2">
                <label for="optionalEquipment" class="block text-sm font-medium text-gray-700">选装 (元)</label>
                <input 
                  type="number" 
                  id="optionalEquipment" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入选装费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
              
              <!-- 开票价 (自动计算) -->
              <div class="space-y-2">
                <label for="invoicePrice" class="block text-sm font-medium text-gray-700">开票价 (元)</label>
                <input 
                  type="number" 
                  id="invoicePrice" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 交强险 -->
              <div class="space-y-2">
                <label for="compulsoryInsurance" class="block text-sm font-medium text-gray-700">交强险 (元)</label>
                <input 
                  type="number" 
                  id="compulsoryInsurance" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入交强险费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第二区：退税，手续费 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-calculator text-primary mr-2"></i>税费信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 退税 -->
              <div class="space-y-2">
                <label for="taxRefund" class="block text-sm font-medium text-gray-700">退税 (元)</label>
                <input 
                  type="number" 
                  id="taxRefund" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 手续费 -->
              <div class="space-y-2">
                <label for="serviceFeeRate" class="block text-sm font-medium text-gray-700">手续费</label>
                <div class="flex flex-col">
                  <input 
                    type="range" 
                    id="serviceFeeRate" 
                    min="0.04" 
                    max="0.1" 
                    step="0.01" 
                    value="0.04"
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
                  >
                  <div class="flex justify-between mt-1">
                    <span id="serviceFeeRateValue" class="text-sm text-gray-600">0.04</span>
                    <span id="serviceFee" class="text-sm font-medium text-primary">0.00 元</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 第三区：国内运输，国际运输 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-truck text-primary mr-2"></i>运输费用
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 国内运输 -->
              <div class="space-y-2">
                <label for="domesticShipping" class="block text-sm font-medium text-gray-700">国内运输 (元)</label>
                <input 
                  type="number" 
                  id="domesticShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国内运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 国际运输 (条件显示) -->
              <div id="internationalShippingContainer" class="space-y-2 hidden">
                <label for="internationalShipping" class="block text-sm font-medium text-gray-700">国际运输 (元)</label>
                <input 
                  type="number" 
                  id="internationalShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国际运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第四区：购车成本，利润，报价人民币 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 购车成本 (自动计算) -->
              <div class="space-y-2">
                <label for="purchaseCost" class="block text-sm font-medium text-gray-700">购车成本 (元)</label>
                <input 
                  type="number" 
                  id="purchaseCost" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 利润 -->
              <div class="space-y-2">
                <label for="profit" class="block text-sm font-medium text-gray-700">利润 (元)</label>
                <input 
                  type="number" 
                  id="profit" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入期望利润"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 报价（人民币） -->
              <div class="space-y-2 md:col-span-2">
                <label for="rmbQuote" class="block text-sm font-medium text-gray-700">报价（人民币） (元)</label>
                <input 
                  type="number" 
                  id="rmbQuote" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
            </div>
          </div>
        </section>
        
        <!-- 二手车表单 (默认隐藏) -->
        <section id="usedCarForm" class="hidden space-y-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-car text-primary mr-2"></i>二手车报价信息
          </h3>
          
          <!-- 报价类型 -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价类型
            </label>
            <div class="flex flex-wrap gap-3">
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="EXW" class="text-primary focus:ring-primary" checked>
                <span class="ml-2">EXW</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="FOB" class="text-primary focus:ring-primary">
                <span class="ml-2">FOB</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="CIF" class="text-primary focus:ring-primary">
                <span class="ml-2">CIF</span>
              </label>
            </div>
          </div>
          
          <!-- 第一区：指导价，优惠，选装，开票价，交强险 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-tag text-primary mr-2"></i>基础价格信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 指导价 -->
              <div class="space-y-2">
                <label for="usedGuidePrice" class="block text-sm font-medium text-gray-700">指导价 (元)</label>
                <input 
                  type="number" 
                  id="usedGuidePrice" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入指导价"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 优惠 -->
              <div class="space-y-2">
                <label for="usedDiscount" class="block text-sm font-medium text-gray-700">优惠 (元)</label>
                <input 
                  type="number" 
                  id="usedDiscount" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入优惠金额"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 选装 -->
              <div class="space-y-2">
                <label for="usedOptionalEquipment" class="block text-sm font-medium text-gray-700">选装 (元)</label>
                <input 
                  type="number" 
                  id="usedOptionalEquipment" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入选装费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
              
              <!-- 开票价 (自动计算) -->
              <div class="space-y-2">
                <label for="usedInvoicePrice" class="block text-sm font-medium text-gray-700">开票价 (元)</label>
                <input 
                  type="number" 
                  id="usedInvoicePrice" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 交强险 -->
              <div class="space-y-2">
                <label for="usedCompulsoryInsurance" class="block text-sm font-medium text-gray-700">交强险 (元)</label>
                <input 
                  type="number" 
                  id="usedCompulsoryInsurance" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入交强险费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第二区：购置税，资质费，代办费 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-calculator text-primary mr-2"></i>税费及服务费用
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 购置税 (自动计算) -->
              <div class="space-y-2">
                <label for="usedPurchaseTax" class="block text-sm font-medium text-gray-700">购置税 (元)</label>
                <input 
                  type="number" 
                  id="usedPurchaseTax" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 资质费用 -->
              <div class="space-y-2">
                <label for="usedQualificationFee" class="block text-sm font-medium text-gray-700">资质费用 (元)</label>
                <input 
                  type="number" 
                  id="usedQualificationFee" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入资质费用"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 代办费 -->
              <div class="space-y-2">
                <label for="usedAgencyFee" class="block text-sm font-medium text-gray-700">代办费 (元)</label>
                <input 
                  type="number" 
                  id="usedAgencyFee" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入代办费用"
                  step="0.01"
                  min="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第三区：退税，退税手续费 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-sign-out text-primary mr-2"></i>退税信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 退税 (自动计算) -->
              <div class="space-y-2">
                <label for="usedTaxRefund" class="block text-sm font-medium text-gray-700">退税 (元)</label>
                <input 
                  type="number" 
                  id="usedTaxRefund" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 退税手续费 (自动计算) -->
              <div class="space-y-2">
                <label for="usedTaxRefundFee" class="block text-sm font-medium text-gray-700">退税手续费 (元)</label>
                <input 
                  type="number" 
                  id="usedTaxRefundFee" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
            </div>
          </div>
          
          <!-- 第四区：国内运输，国际运输 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-truck text-primary mr-2"></i>运输费用
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 国内运输 -->
              <div class="space-y-2">
                <label for="usedDomesticShipping" class="block text-sm font-medium text-gray-700">国内运输 (元)</label>
                <input 
                  type="number" 
                  id="usedDomesticShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国内运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 国际运输 (条件显示) -->
              <div id="usedInternationalShippingContainer" class="space-y-2 hidden">
                <label for="usedInternationalShipping" class="block text-sm font-medium text-gray-700">国际运输 (元)</label>
                <input 
                  type="number" 
                  id="usedInternationalShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国际运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第五区：购车成本，利润，报价人民币 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 购车成本 (自动计算) -->
              <div class="space-y-2">
                <label for="usedPurchaseCost" class="block text-sm font-medium text-gray-700">购车成本 (元)</label>
                <input 
                  type="number" 
                  id="usedPurchaseCost" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 利润 -->
              <div class="space-y-2">
                <label for="usedProfit" class="block text-sm font-medium text-gray-700">利润 (元)</label>
                <input 
                  type="number" 
                  id="usedProfit" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入期望利润"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 报价（人民币） -->
              <div class="space-y-2 md:col-span-2">
                <label for="usedRmbQuote" class="block text-sm font-medium text-gray-700">报价（人民币） (元)</label>
                <input 
                  type="number" 
                  id="usedRmbQuote" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
            </div>
          </div>
        </section>
        
        <!-- 新能源表单 (默认隐藏) -->
        <section id="newEnergyForm" class="hidden space-y-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-leaf text-primary mr-2"></i>新能源报价信息
          </h3>
          
          <!-- 报价类型 -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价类型
            </label>
            <div class="flex flex-wrap gap-3">
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="newEnergyQuoteType" value="EXW" class="text-primary focus:ring-primary" checked>
                <span class="ml-2">EXW</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="newEnergyQuoteType" value="FOB" class="text-primary focus:ring-primary">
                <span class="ml-2">FOB</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="newEnergyQuoteType" value="CIF" class="text-primary focus:ring-primary">
                <span class="ml-2">CIF</span>
              </label>
          </div>
          </div>
          
          <!-- 第一区：指导价，优惠，选装，开票价，交强险 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-tag text-primary mr-2"></i>基础价格信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 指导价 -->
              <div class="space-y-2">
                <label for="newEnergyGuidePrice" class="block text-sm font-medium text-gray-700">指导价 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyGuidePrice" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入指导价"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 优惠 -->
              <div class="space-y-2">
                <label for="newEnergyDiscount" class="block text-sm font-medium text-gray-700">优惠 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyDiscount" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入优惠金额"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 选装 -->
              <div class="space-y-2">
                <label for="newEnergyOptionalEquipment" class="block text-sm font-medium text-gray-700">选装 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyOptionalEquipment" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入选装费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
              
              <!-- 开票价 (自动计算) -->
              <div class="space-y-2">
                <label for="newEnergyInvoicePrice" class="block text-sm font-medium text-gray-700">开票价 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyInvoicePrice" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 交强险 -->
              <div class="space-y-2">
                <label for="newEnergyCompulsoryInsurance" class="block text-sm font-medium text-gray-700">交强险 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyCompulsoryInsurance" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入交强险费用"
                  step="0.01"
                  min="0"
                  value="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第二区：购置税，资质费，代办费 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-calculator text-primary mr-2"></i>税费及服务费用
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 购置税 (自动计算) -->
              <div class="space-y-2">
                <label for="newEnergyPurchaseTax" class="block text-sm font-medium text-gray-700">购置税 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyPurchaseTax" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
                <div class="text-xs text-gray-500">
                  <i class="fa fa-info-circle mr-1"></i>
                  <span id="newEnergyTaxNote">开票价低于33.9万元免征购置税</span>
                </div>
              </div>
              
              <!-- 资质费用 -->
              <div class="space-y-2">
                <label for="newEnergyQualificationFee" class="block text-sm font-medium text-gray-700">资质费用 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyQualificationFee" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入资质费用"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 代办费 -->
              <div class="space-y-2">
                <label for="newEnergyAgencyFee" class="block text-sm font-medium text-gray-700">代办费 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyAgencyFee" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入代办费用"
                  step="0.01"
                  min="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第三区：退税，退税手续费 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-sign-out text-primary mr-2"></i>退税信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 退税 (自动计算) -->
              <div class="space-y-2">
                <label for="newEnergyTaxRefund" class="block text-sm font-medium text-gray-700">退税 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyTaxRefund" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 退税手续费 (自动计算) -->
              <div class="space-y-2">
                <label for="newEnergyTaxRefundFee" class="block text-sm font-medium text-gray-700">退税手续费 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyTaxRefundFee" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
            </div>
          </div>
          
          <!-- 第四区：国内运输，国际运输 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-truck text-primary mr-2"></i>运输费用
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 国内运输 -->
              <div class="space-y-2">
                <label for="newEnergyDomesticShipping" class="block text-sm font-medium text-gray-700">国内运输 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyDomesticShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国内运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 国际运输 (条件显示) -->
              <div id="newEnergyInternationalShippingContainer" class="space-y-2 hidden">
                <label for="newEnergyInternationalShipping" class="block text-sm font-medium text-gray-700">国际运输 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyInternationalShipping" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入国际运输费用"
                  step="0.01"
                  min="0"
                >
              </div>
            </div>
          </div>
          
          <!-- 第五区：购车成本，利润，报价人民币 -->
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
              <i class="fa fa-dollar text-primary mr-2"></i>报价信息
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 购车成本 (自动计算) -->
              <div class="space-y-2">
                <label for="newEnergyPurchaseCost" class="block text-sm font-medium text-gray-700">购车成本 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyPurchaseCost" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
              
              <!-- 利润 -->
              <div class="space-y-2">
                <label for="newEnergyProfit" class="block text-sm font-medium text-gray-700">利润 (元)</label>
                <input 
                  type="number" 
                  id="newEnergyProfit" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  placeholder="输入期望利润"
                  step="0.01"
                  min="0"
                >
              </div>
              
              <!-- 报价（人民币） -->
              <div class="space-y-2 md:col-span-2">
                <label for="newEnergyRmbQuote" class="block text-sm font-medium text-gray-700">报价（人民币） (元)</label>
                <input 
                  type="number" 
                  id="newEnergyRmbQuote" 
                  class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                  placeholder="自动计算"
                  step="0.01"
                  readonly
                >
              </div>
            </div>
          </div>
        </section>
        
        <!-- 汇率和最终报价统一显示在表单下方 -->
        <div id="currencySectionContainer" class="mt-4">
          <!-- 汇率和最终报价（移到新车/二手车表单下方，统一显示） -->
          <div id="currencySection" class="mt-6 hidden">
            <!-- 第六区：选择币种，汇率，最终报价 -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
              <h4 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                <i class="fa fa-exchange text-primary mr-2"></i>汇率及最终报价
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                  <label for="currency" class="block text-sm font-medium text-gray-700">选择币种</label>
                  <select 
                    id="currency" 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                  >
                    <option value="USD" selected>美元 (USD)</option>
                    <option value="EUR">欧元 (EUR)</option>
                    <option value="GBP">英镑 (GBP)</option>
                  </select>
                </div>
                <div class="space-y-2">
                  <label for="exchangeRate" class="block text-sm font-medium text-gray-700" id="exchangeRateLabel">汇率 实时基准：显示汇率数值</label>
                  <input 
                    type="number" 
                    id="exchangeRate" 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                    placeholder="加载中..."
                    step="0.0001"
                  >
                </div>
                <div class="space-y-2 md:col-span-2">
                  <label for="finalQuote" class="block text-sm font-medium text-gray-700">最终报价</label>
                  <input 
                    type="number" 
                    id="finalQuote" 
                    class="w-full px-4 py-3 border-2 border-primary bg-primary/5 rounded-lg text-lg font-medium input-focus transition-custom"
                    placeholder="自动计算"
                    step="0.01"
                    readonly
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 提交按钮 -->
        <div class="flex justify-center pt-4">
          <button 
            type="button" 
            id="calculateBtn"
            class="px-8 py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-custom flex items-center"
          >
            <i class="fa fa-calculator mr-2"></i>计算报价
          </button>
        </div>
      </form>
    </div>
    
    <!-- 报价结果卡片 -->
    <div id="resultCard" class="hidden bg-white rounded-xl shadow-md p-6 md:p-8 mb-8 transform transition-custom hover:shadow-lg">
      <h3 class="text-xl font-semibold mb-6 flex items-center">
        <i class="fa fa-file-text-o text-primary mr-2"></i>报价结果
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="border-b border-gray-100 pb-4 md:border-b-0 md:border-r border-gray-100 md:pr-6">
          <h4 class="text-lg font-medium text-gray-700 mb-4">基础信息</h4>
          <ul class="space-y-3">
            <li class="flex justify-between">
              <span class="text-gray-600">车型名称:</span>
              <span id="resultCarModel" class="font-medium"></span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">车型类型:</span>
              <span id="resultCarType" class="font-medium"></span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">报价类型:</span>
              <span id="resultQuoteType" class="font-medium"></span>
            </li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-medium text-gray-700 mb-4">成本明细</h4>
          <ul class="space-y-3" id="resultCostDetails">
            <!-- 动态填充 -->
          </ul>
        </div>
      </div>
      
      <div class="mt-6 pt-6 border-t border-gray-100">
        <h4 class="text-lg font-medium text-gray-700 mb-4">报价汇总</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-500 mb-1">人民币报价</div>
            <div id="resultRmbQuote" class="text-lg font-semibold"></div>
          </div>
          <div class="bg-primary/10 p-4 rounded-lg text-center border border-primary/20">
            <div class="text-sm text-gray-500 mb-1" id="resultCurrencyText">最终报价 (USD)</div>
            <div id="resultFinalQuote" class="text-lg font-semibold text-primary"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white shadow-sm py-8 transition-custom">
    <div class="container mx-auto px-4">
      <div class="text-center text-gray-500 text-sm">
        Designed by DTBKnight
      </div>
    </div>
  </footer>

  <script>
    // 格式化数字为货币格式
    function formatCurrency(value, currency = 'CNY') {
      if (isNaN(value) || value === '' || value === null) return '0.00';
      
      const options = {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      };
      
      if (currency === 'CNY') {
        options.style = 'currency';
        options.currency = 'CNY';
      } else if (currency === 'USD') {
        options.style = 'currency';
        options.currency = 'USD';
      } else if (currency === 'EUR') {
        options.style = 'currency';
        options.currency = 'EUR';
      } else if (currency === 'GBP') {
        options.style = 'currency';
        options.currency = 'GBP';
      }
      
      return new Intl.NumberFormat('zh-CN', options).format(value);
    }
    
    // 格式化数字为整数货币格式（不显示小数点）
    function formatCurrencyInteger(value, currency = 'CNY') {
      if (isNaN(value) || value === '' || value === null) return '¥0';
      
      const options = {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      };
      
      if (currency === 'CNY') {
        options.style = 'currency';
        options.currency = 'CNY';
      } else if (currency === 'USD') {
        options.style = 'currency';
        options.currency = 'USD';
      } else if (currency === 'EUR') {
        options.style = 'currency';
        options.currency = 'EUR';
      } else if (currency === 'GBP') {
        options.style = 'currency';
        options.currency = 'GBP';
      }
      
      return new Intl.NumberFormat('zh-CN', options).format(value);
    }
    
    // 处理车型类型切换 - 核心修复部分
    document.getElementById('carType').addEventListener('change', function() {
      const carType = this.value;
      
      // 隐藏所有表单
      document.getElementById('newCarForm').classList.add('hidden');
      document.getElementById('usedCarForm').classList.add('hidden');
      document.getElementById('newEnergyForm').classList.add('hidden');
      
      // 显示选中的表单
      if (carType === 'new') {
        document.getElementById('newCarForm').classList.remove('hidden');
        document.getElementById('newCarForm').classList.add('animate-fadeIn');
        // 切换到新车主题（蓝色）
        switchToNewCarTheme();
      } else if (carType === 'used') {
        document.getElementById('usedCarForm').classList.remove('hidden');
        document.getElementById('usedCarForm').classList.add('animate-fadeIn');
        // 切换到二手车主题（棕色）
        switchToUsedCarTheme();
      } else if (carType === 'newEnergyTax') {
        document.getElementById('newEnergyForm').classList.remove('hidden');
        document.getElementById('newEnergyForm').classList.add('animate-fadeIn');
        // 新能源使用绿色主题
        switchToNewEnergyTheme();
      }
    });
    
    // 切换到新车主题（蓝色）
    function switchToNewCarTheme() {
      const body = document.getElementById('mainBody');
      body.classList.remove('used-car-theme', 'new-energy-theme');
      
      // 更新所有主要颜色元素
      updateThemeColors('#165DFF', '#36CFC9', '#FF7D00');
    }
    
    // 切换到二手车主题（橙色）
    function switchToUsedCarTheme() {
      const body = document.getElementById('mainBody');
      body.classList.remove('new-energy-theme');
      body.classList.add('used-car-theme');
      
      // 更新所有主要颜色元素 - 使用橙色主题
      updateThemeColors('#FF6B35', '#FF8C42', '#FF7D00');
    }
    
    // 切换到新能源主题（绿色）
    function switchToNewEnergyTheme() {
      const body = document.getElementById('mainBody');
      body.classList.remove('used-car-theme');
      body.classList.add('new-energy-theme');
      
      // 更新所有主要颜色元素
      updateThemeColors('#22C55E', '#4ADE80', '#FF7D00');
    }
    
    // 更新主题颜色
    function updateThemeColors(primary, secondary, accent) {
      // 更新CSS变量
      document.documentElement.style.setProperty('--primary-color', primary);
      document.documentElement.style.setProperty('--secondary-color', secondary);
      document.documentElement.style.setProperty('--accent-color', accent);
      
      // 更新滑块颜色
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        slider.style.setProperty('--tw-accent-color', primary);
      });
      
      // 更新单选按钮颜色
      const radios = document.querySelectorAll('input[type="radio"]');
      radios.forEach(radio => {
        radio.style.setProperty('--tw-accent-color', primary);
      });
    }
    
    // 主题系统
    function initThemeSystem() {
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const body = document.getElementById('mainBody');
      
      // 检查本地存储的主题设置
      const savedTheme = localStorage.getItem('theme');
      const currentTime = new Date().getHours();
      
      // 确定初始主题
      let initialTheme = 'light';
      if (savedTheme) {
        initialTheme = savedTheme;
      } else {
        // 根据时间自动设置主题：6-18点为白天，其他为夜晚
        initialTheme = (currentTime >= 6 && currentTime < 18) ? 'light' : 'dark';
      }
      
      // 应用主题
      applyTheme(initialTheme);
      
      // 主题切换按钮事件
      themeToggle.addEventListener('click', function() {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
      });
      
      // 每小时检查一次时间，自动切换主题
      setInterval(function() {
        const currentTime = new Date().getHours();
        const currentTheme = body.getAttribute('data-theme');
        const autoTheme = (currentTime >= 6 && currentTime < 18) ? 'light' : 'dark';
        
        // 只有在没有手动设置主题时才自动切换
        if (!localStorage.getItem('theme') && currentTheme !== autoTheme) {
          applyTheme(autoTheme);
        }
      }, 60 * 60 * 1000); // 每小时检查一次
    }
    
    // 应用主题
    function applyTheme(theme) {
      const body = document.getElementById('mainBody');
      const html = document.documentElement;
      const themeIcon = document.getElementById('themeIcon');
      
      body.setAttribute('data-theme', theme);
      
      if (theme === 'dark') {
        html.classList.remove('light');
        html.classList.add('dark');
        themeIcon.className = 'fa fa-moon-o text-gray-300';
        document.title = 'Quotation Calculator';
        // 更新RGB颜色变量
        document.documentElement.style.setProperty('--primary-color-rgb', '22, 93, 255');
      } else {
        html.classList.remove('dark');
        html.classList.add('light');
        themeIcon.className = 'fa fa-sun-o text-gray-600';
        document.title = 'Quotation Calculator';
        // 更新RGB颜色变量
        document.documentElement.style.setProperty('--primary-color-rgb', '22, 93, 255');
      }
      
      // 添加切换动画（移除内联样式，使用CSS类）
      body.classList.add('theme-transitioning');
      setTimeout(() => {
        body.classList.remove('theme-transitioning');
      }, 150);
    }
    
    // 处理新车报价类型切换（显示/隐藏国际运输）
    document.querySelectorAll('input[name="quoteType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const container = document.getElementById('internationalShippingContainer');
        if (this.value === 'EXW') {
          container.classList.add('hidden');
          document.getElementById('internationalShipping').value = '';
        } else {
          container.classList.remove('hidden');
          container.classList.add('animate-fadeIn');
        }
        calculateNewCarAll();
      });
    });
    
    // 处理二手车报价类型切换（显示/隐藏国际运输）
    document.querySelectorAll('input[name="usedQuoteType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const container = document.getElementById('usedInternationalShippingContainer');
        if (this.value === 'EXW') {
          container.classList.add('hidden');
          document.getElementById('usedInternationalShipping').value = '';
        } else {
          container.classList.remove('hidden');
          container.classList.add('animate-fadeIn');
        }
        calculateUsedCarAll();
      });
    });
    
    // 处理新能源报价类型切换（显示/隐藏国际运输）
    document.querySelectorAll('input[name="newEnergyQuoteType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const container = document.getElementById('newEnergyInternationalShippingContainer');
        if (this.value === 'EXW') {
          container.classList.add('hidden');
          document.getElementById('newEnergyInternationalShipping').value = '';
        } else {
          container.classList.remove('hidden');
          container.classList.add('animate-fadeIn');
        }
        calculateNewEnergyAll();
      });
    });
    
    // 新车表单 - 手续费系数滑块
    const serviceFeeRate = document.getElementById('serviceFeeRate');
    const serviceFeeRateValue = document.getElementById('serviceFeeRateValue');
    const serviceFee = document.getElementById('serviceFee');
    
    serviceFeeRate.addEventListener('input', function() {
      const value = parseFloat(this.value).toFixed(2);
      serviceFeeRateValue.textContent = value;
      calculateNewCarServiceFee();
      calculateNewCarPurchaseCost();
      calculateNewCarRmbQuote();
      calculateFinalQuote();
    });
    
    // 新车计算 - 开票价
    function calculateNewCarInvoicePrice() {
      const guidePrice = parseFloat(document.getElementById('guidePrice').value) || 0;
      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const optionalEquipment = parseFloat(document.getElementById('optionalEquipment').value) || 0;
      const invoicePrice = Math.max(0, guidePrice + optionalEquipment - discount);
      document.getElementById('invoicePrice').value = Math.round(invoicePrice);
      return invoicePrice;
    }
    
    // 新车计算 - 退税
    function calculateNewCarTaxRefund() {
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const taxRefund = invoicePrice / 1.13 * 0.13;
      document.getElementById('taxRefund').value = taxRefund.toFixed(2);
      return taxRefund;
    }
    
    // 新车计算 - 手续费
    function calculateNewCarServiceFee() {
      const rate = parseFloat(document.getElementById('serviceFeeRate').value);
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const fee = rate * invoicePrice;
      serviceFee.textContent = formatCurrency(Math.round(fee));
      return fee;
    }
    
    // 新车计算 - 购车成本
    function calculateNewCarPurchaseCost() {
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const serviceFee = calculateNewCarServiceFee();
      const domesticShipping = parseFloat(document.getElementById('domesticShipping').value) || 0;
      const internationalShipping = parseFloat(document.getElementById('internationalShipping').value) || 0;
      const compulsoryInsurance = parseFloat(document.getElementById('compulsoryInsurance').value) || 0;
      const taxRefund = parseFloat(document.getElementById('taxRefund').value) || 0;
      
      const purchaseCost = invoicePrice + serviceFee + domesticShipping + internationalShipping + compulsoryInsurance - taxRefund;
      document.getElementById('purchaseCost').value = Math.round(purchaseCost);
      return purchaseCost;
    }
    
    // 新车计算 - 人民币报价
    function calculateNewCarRmbQuote() {
      const purchaseCost = parseFloat(document.getElementById('purchaseCost').value) || 0;
      const profit = parseFloat(document.getElementById('profit').value) || 0;
      const rmbQuote = purchaseCost + profit;
      document.getElementById('rmbQuote').value = Math.round(rmbQuote);
      return rmbQuote;
    }
    
    // 二手车计算 - 开票价
    function calculateUsedCarInvoicePrice() {
      const guidePrice = parseFloat(document.getElementById('usedGuidePrice').value) || 0;
      const discount = parseFloat(document.getElementById('usedDiscount').value) || 0;
      const optionalEquipment = parseFloat(document.getElementById('usedOptionalEquipment').value) || 0;
      const invoicePrice = Math.max(0, guidePrice + optionalEquipment - discount);
      document.getElementById('usedInvoicePrice').value = Math.round(invoicePrice);
      return invoicePrice;
    }
    
    // 二手车计算 - 购置税
    function calculateUsedCarPurchaseTax() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const purchaseTax = invoicePrice / 11.3;
      document.getElementById('usedPurchaseTax').value = purchaseTax.toFixed(2);
      return purchaseTax;
    }
    
    // 二手车计算 - 退税
    function calculateUsedCarTaxRefund() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const taxRefund = invoicePrice / 1.13 * 0.13;
      document.getElementById('usedTaxRefund').value = taxRefund.toFixed(2);
      return taxRefund;
    }
    
    // 二手车计算 - 退税手续费
    function calculateUsedCarTaxRefundFee() {
      const taxRefund = parseFloat(document.getElementById('usedTaxRefund').value) || 0;
      const taxRefundFee = taxRefund * 0.025;
      document.getElementById('usedTaxRefundFee').value = Math.round(taxRefundFee);
      return taxRefundFee;
    }
    
    // 二手车计算 - 购车成本
    function calculateUsedCarPurchaseCost() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const purchaseTax = calculateUsedCarPurchaseTax();
      const qualificationFee = parseFloat(document.getElementById('usedQualificationFee').value) || 0;
      const agencyFee = parseFloat(document.getElementById('usedAgencyFee').value) || 0;
      const taxRefund = parseFloat(document.getElementById('usedTaxRefund').value) || 0;
      const taxRefundFee = calculateUsedCarTaxRefundFee();
      const domesticShipping = parseFloat(document.getElementById('usedDomesticShipping').value) || 0;
      const internationalShipping = parseFloat(document.getElementById('usedInternationalShipping').value) || 0;
      const compulsoryInsurance = parseFloat(document.getElementById('usedCompulsoryInsurance').value) || 0;
      
      const purchaseCost = invoicePrice + purchaseTax + qualificationFee + agencyFee + taxRefundFee + domesticShipping + internationalShipping + compulsoryInsurance - taxRefund;
      document.getElementById('usedPurchaseCost').value = Math.round(purchaseCost);
      return purchaseCost;
    }
    
    // 二手车计算 - 人民币报价
    function calculateUsedCarRmbQuote() {
      const purchaseCost = parseFloat(document.getElementById('usedPurchaseCost').value) || 0;
      const profit = parseFloat(document.getElementById('usedProfit').value) || 0;
      const rmbQuote = purchaseCost + profit;
      document.getElementById('usedRmbQuote').value = Math.round(rmbQuote);
      return rmbQuote;
    }
    
    // 新能源计算 - 开票价
    function calculateNewEnergyInvoicePrice() {
      const guidePrice = parseFloat(document.getElementById('newEnergyGuidePrice').value) || 0;
      const discount = parseFloat(document.getElementById('newEnergyDiscount').value) || 0;
      const optionalEquipment = parseFloat(document.getElementById('newEnergyOptionalEquipment').value) || 0;
      const invoicePrice = Math.max(0, guidePrice + optionalEquipment - discount);
      document.getElementById('newEnergyInvoicePrice').value = Math.round(invoicePrice);
      return invoicePrice;
    }
    
    // 新能源计算 - 购置税
    function calculateNewEnergyPurchaseTax() {
      const invoicePrice = parseFloat(document.getElementById('newEnergyInvoicePrice').value) || 0;
      const taxNote = document.getElementById('newEnergyTaxNote');
      const taxNoteContainer = taxNote.parentElement;
      
      if (invoicePrice <= 339000) {
        // 开票价低于33.9万元免征购置税
        document.getElementById('newEnergyPurchaseTax').value = '0.00';
        taxNote.textContent = '免征购置税';
        taxNote.className = 'text-green-600';
        taxNoteContainer.style.display = 'block';
        return 0;
      } else {
        // 开票价高于33.9万元，购置税 = (开票价 - 339000) / 11.3
        const purchaseTax = (invoicePrice - 339000) / 11.3;
        document.getElementById('newEnergyPurchaseTax').value = purchaseTax.toFixed(2);
        taxNoteContainer.style.display = 'none';
        return purchaseTax;
      }
    }
    
    // 新能源计算 - 退税
    function calculateNewEnergyTaxRefund() {
      const invoicePrice = parseFloat(document.getElementById('newEnergyInvoicePrice').value) || 0;
      const taxRefund = invoicePrice / 1.13 * 0.13;
      document.getElementById('newEnergyTaxRefund').value = taxRefund.toFixed(2);
      return taxRefund;
    }
    
    // 新能源计算 - 退税手续费
    function calculateNewEnergyTaxRefundFee() {
      const taxRefund = parseFloat(document.getElementById('newEnergyTaxRefund').value) || 0;
      const taxRefundFee = taxRefund * 0.025;
      document.getElementById('newEnergyTaxRefundFee').value = Math.round(taxRefundFee);
      return taxRefundFee;
    }
    
    // 新能源计算 - 购车成本
    function calculateNewEnergyPurchaseCost() {
      const invoicePrice = parseFloat(document.getElementById('newEnergyInvoicePrice').value) || 0;
      const purchaseTax = calculateNewEnergyPurchaseTax();
      const qualificationFee = parseFloat(document.getElementById('newEnergyQualificationFee').value) || 0;
      const agencyFee = parseFloat(document.getElementById('newEnergyAgencyFee').value) || 0;
      const taxRefund = parseFloat(document.getElementById('newEnergyTaxRefund').value) || 0;
      const taxRefundFee = calculateNewEnergyTaxRefundFee();
      const domesticShipping = parseFloat(document.getElementById('newEnergyDomesticShipping').value) || 0;
      const internationalShipping = parseFloat(document.getElementById('newEnergyInternationalShipping').value) || 0;
      const compulsoryInsurance = parseFloat(document.getElementById('newEnergyCompulsoryInsurance').value) || 0;
      
      const purchaseCost = invoicePrice + purchaseTax + qualificationFee + agencyFee + taxRefundFee + domesticShipping + internationalShipping + compulsoryInsurance - taxRefund;
      document.getElementById('newEnergyPurchaseCost').value = Math.round(purchaseCost);
      return purchaseCost;
    }
    
    // 新能源计算 - 人民币报价
    function calculateNewEnergyRmbQuote() {
      const purchaseCost = parseFloat(document.getElementById('newEnergyPurchaseCost').value) || 0;
      const profit = parseFloat(document.getElementById('newEnergyProfit').value) || 0;
      const rmbQuote = purchaseCost + profit;
      document.getElementById('newEnergyRmbQuote').value = Math.round(rmbQuote);
      return rmbQuote;
    }
    
    // 计算最终报价（新车、二手车、新能源都适用）
    function calculateFinalQuote() {
      const carType = document.getElementById('carType').value;
      let rmbQuote = 0;
      if (carType === 'new') {
        rmbQuote = parseFloat(document.getElementById('rmbQuote').value) || 0;
      } else if (carType === 'used') {
        rmbQuote = parseFloat(document.getElementById('usedRmbQuote').value) || 0;
      } else if (carType === 'newEnergyTax') {
        rmbQuote = parseFloat(document.getElementById('newEnergyRmbQuote').value) || 0;
      }
      const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
      const currency = document.getElementById('currency').value;
      if (currency && exchangeRate > 0 && rmbQuote > 0) {
        const finalQuote = rmbQuote / exchangeRate; // 使用数值栏的汇率（已减去0.05）
        document.getElementById('finalQuote').value = Math.round(finalQuote);
        return finalQuote;
      }
      document.getElementById('finalQuote').value = '';
      return 0;
    }
    
    // 新车计算 - 所有计算
    function calculateNewCarAll() {
      calculateNewCarInvoicePrice();
      calculateNewCarTaxRefund();
      calculateNewCarServiceFee();
      calculateNewCarPurchaseCost();
      calculateNewCarRmbQuote();
      calculateFinalQuote();
    }
    
    // 二手车计算 - 所有计算
    function calculateUsedCarAll() {
      calculateUsedCarInvoicePrice();
      calculateUsedCarPurchaseTax();
      calculateUsedCarTaxRefund();
      calculateUsedCarTaxRefundFee();
      calculateUsedCarPurchaseCost();
      calculateUsedCarRmbQuote();
      calculateFinalQuote();
    }
    
    // 新能源计算 - 所有计算
    function calculateNewEnergyAll() {
      calculateNewEnergyInvoicePrice();
      calculateNewEnergyPurchaseTax();
      calculateNewEnergyTaxRefund();
      calculateNewEnergyTaxRefundFee();
      calculateNewEnergyPurchaseCost();
      calculateNewEnergyRmbQuote();
      calculateFinalQuote();
    }
    
    // 绑定新车表单输入事件
    document.getElementById('guidePrice').addEventListener('input', calculateNewCarAll);
    document.getElementById('discount').addEventListener('input', calculateNewCarAll);
    document.getElementById('optionalEquipment').addEventListener('input', calculateNewCarAll);
    document.getElementById('compulsoryInsurance').addEventListener('input', calculateNewCarAll);
    document.getElementById('domesticShipping').addEventListener('input', calculateNewCarAll);
    document.getElementById('internationalShipping').addEventListener('input', calculateNewCarAll);
    document.getElementById('profit').addEventListener('input', calculateNewCarAll);
    
    // 绑定二手车表单输入事件
    document.getElementById('usedGuidePrice').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedDiscount').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedOptionalEquipment').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedCompulsoryInsurance').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedQualificationFee').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedAgencyFee').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedDomesticShipping').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedInternationalShipping').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedProfit').addEventListener('input', calculateUsedCarAll);
    
    // 绑定新能源表单输入事件
    document.getElementById('newEnergyGuidePrice').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyDiscount').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyOptionalEquipment').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyCompulsoryInsurance').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyQualificationFee').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyAgencyFee').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyDomesticShipping').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyInternationalShipping').addEventListener('input', calculateNewEnergyAll);
    document.getElementById('newEnergyProfit').addEventListener('input', calculateNewEnergyAll);
    
    // 新车、二手车输入变动时都重新计算最终报价
    document.getElementById('rmbQuote').addEventListener('input', calculateFinalQuote);
    document.getElementById('usedRmbQuote').addEventListener('input', calculateFinalQuote);
    
    // 让汇率和最终报价在新车/二手车/新能源表单下方显示
    function moveCurrencySection() {
      const carType = document.getElementById('carType').value;
      const currencySection = document.getElementById('currencySection');
      if (carType === 'new' || carType === 'used' || carType === 'newEnergyTax') {
        currencySection.classList.remove('hidden');
      } else {
        currencySection.classList.add('hidden');
      }
    }
    document.getElementById('carType').addEventListener('change', moveCurrencySection);
    window.addEventListener('DOMContentLoaded', moveCurrencySection);

    // 绑定币种和汇率事件（新车、二手车都适用）
    document.getElementById('currency').addEventListener('change', function() {
      const currency = this.value;
      if (currency) {
        fetchExchangeRate(currency);
      } else {
        document.getElementById('exchangeRate').value = '';
        document.getElementById('finalQuote').value = '';
      }
    });
    
    // 汇率输入框手动输入事件
    document.getElementById('exchangeRate').addEventListener('input', function() {
      calculateFinalQuote();
    });
    
    // 计算按钮点击事件
    document.getElementById('calculateBtn').addEventListener('click', function() {
      const carType = document.getElementById('carType').value;
      
      // 根据车型类型计算
      if (carType === 'new') {
        calculateNewCarAll();
      } else if (carType === 'used') {
        calculateUsedCarAll();
      } else if (carType === 'newEnergyTax') {
        calculateNewEnergyAll();
      }
      
      // 确保最终报价被计算
      calculateFinalQuote();
      
      // 显示结果卡片
      const resultCard = document.getElementById('resultCard');
      resultCard.classList.remove('hidden');
      resultCard.classList.add('animate-fadeIn');
      
      // 填充结果数据
      fillResultData();
      
      // 滚动到结果区域
      resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    
    // 填充结果数据
    function fillResultData() {
      const carType = document.getElementById('carType').value;
      const carTypeText = document.getElementById('carType').options[document.getElementById('carType').selectedIndex].text;
      
      // 基础信息
      document.getElementById('resultCarModel').textContent = document.getElementById('carModel').value || '未填写';
      document.getElementById('resultCarType').textContent = carTypeText || '未选择';
      
      // 报价类型
      let quoteTypeText = '未选择';
      if (carType === 'new') {
        document.querySelectorAll('input[name="quoteType"]').forEach(radio => {
          if (radio.checked) quoteTypeText = radio.value;
        });
      } else if (carType === 'used') {
        document.querySelectorAll('input[name="usedQuoteType"]').forEach(radio => {
          if (radio.checked) quoteTypeText = radio.value;
        });
      } else if (carType === 'newEnergyTax') {
        document.querySelectorAll('input[name="newEnergyQuoteType"]').forEach(radio => {
          if (radio.checked) quoteTypeText = radio.value;
        });
      }
      document.getElementById('resultQuoteType').textContent = quoteTypeText;
      
      // 填充成本明细
      const costDetails = document.getElementById('resultCostDetails');
      costDetails.innerHTML = '';
      
      // 根据车型类型填充不同的成本明细
      if (carType === 'new') {
        addCostDetail(costDetails, '开票价', document.getElementById('invoicePrice').value);
        
        const optionalEquipment = document.getElementById('optionalEquipment').value;
        if (optionalEquipment && parseFloat(optionalEquipment) > 0) {
          addCostDetail(costDetails, '选装', optionalEquipment);
        }
        
        addCostDetail(costDetails, '国内运输', document.getElementById('domesticShipping').value);
        
        const internationalShipping = document.getElementById('internationalShipping').value;
        if (internationalShipping) {
          addCostDetail(costDetails, '国际运输', internationalShipping);
        }
        
        const compulsoryInsurance = document.getElementById('compulsoryInsurance').value;
        if (compulsoryInsurance && parseFloat(compulsoryInsurance) > 0) {
          addCostDetail(costDetails, '交强险', compulsoryInsurance);
        }
        
        addCostDetail(costDetails, '退税', document.getElementById('taxRefund').value, true);
        addCostDetail(costDetails, '购车成本', document.getElementById('purchaseCost').value, false, true);
        
        // 报价汇总
        document.getElementById('resultRmbQuote').textContent = formatCurrencyInteger(Math.round(parseFloat(document.getElementById('rmbQuote').value) || 0));
      } else if (carType === 'used') {
        addCostDetail(costDetails, '开票价', document.getElementById('usedInvoicePrice').value);
        
        const optionalEquipment = document.getElementById('usedOptionalEquipment').value;
        if (optionalEquipment && parseFloat(optionalEquipment) > 0) {
          addCostDetail(costDetails, '选装', optionalEquipment);
        }
        
        addCostDetail(costDetails, '购置税', document.getElementById('usedPurchaseTax').value);
        addCostDetail(costDetails, '资质费用', document.getElementById('usedQualificationFee').value);
        addCostDetail(costDetails, '代办费', document.getElementById('usedAgencyFee').value);
        addCostDetail(costDetails, '退税', document.getElementById('usedTaxRefund').value, true);
        addCostDetail(costDetails, '退税手续费', document.getElementById('usedTaxRefundFee').value);
        addCostDetail(costDetails, '国内运输', document.getElementById('usedDomesticShipping').value);
        
        const internationalShipping = document.getElementById('usedInternationalShipping').value;
        if (internationalShipping) {
          addCostDetail(costDetails, '国际运输', internationalShipping);
        }
        
        const compulsoryInsurance = document.getElementById('usedCompulsoryInsurance').value;
        if (compulsoryInsurance && parseFloat(compulsoryInsurance) > 0) {
          addCostDetail(costDetails, '交强险', compulsoryInsurance);
        }
        
        addCostDetail(costDetails, '购车成本', document.getElementById('usedPurchaseCost').value, false, true);
        
        // 报价汇总
        document.getElementById('resultRmbQuote').textContent = formatCurrencyInteger(Math.round(parseFloat(document.getElementById('usedRmbQuote').value) || 0));
      } else if (carType === 'newEnergyTax') {
        addCostDetail(costDetails, '开票价', document.getElementById('newEnergyInvoicePrice').value);
        
        const optionalEquipment = document.getElementById('newEnergyOptionalEquipment').value;
        if (optionalEquipment && parseFloat(optionalEquipment) > 0) {
          addCostDetail(costDetails, '选装', optionalEquipment);
        }
        
        addCostDetail(costDetails, '购置税', document.getElementById('newEnergyPurchaseTax').value);
        addCostDetail(costDetails, '资质费用', document.getElementById('newEnergyQualificationFee').value);
        addCostDetail(costDetails, '代办费', document.getElementById('newEnergyAgencyFee').value);
        addCostDetail(costDetails, '退税', document.getElementById('newEnergyTaxRefund').value, true);
        addCostDetail(costDetails, '退税手续费', document.getElementById('newEnergyTaxRefundFee').value);
        addCostDetail(costDetails, '国内运输', document.getElementById('newEnergyDomesticShipping').value);
        
        const internationalShipping = document.getElementById('newEnergyInternationalShipping').value;
        if (internationalShipping) {
          addCostDetail(costDetails, '国际运输', internationalShipping);
        }
        
        const compulsoryInsurance = document.getElementById('newEnergyCompulsoryInsurance').value;
        if (compulsoryInsurance && parseFloat(compulsoryInsurance) > 0) {
          addCostDetail(costDetails, '交强险', compulsoryInsurance);
        }
        
        addCostDetail(costDetails, '购车成本', document.getElementById('newEnergyPurchaseCost').value, false, true);
        
        // 报价汇总
        document.getElementById('resultRmbQuote').textContent = formatCurrencyInteger(Math.round(parseFloat(document.getElementById('newEnergyRmbQuote').value) || 0));
      }
      
      // 最终报价
      const currency = document.getElementById('currency').value;
      const currencyText = currency === 'USD' ? '美元 (USD)' : currency === 'EUR' ? '欧元 (EUR)' : currency === 'GBP' ? '英镑 (GBP)' : '未选择';
      document.getElementById('resultCurrencyText').textContent = `最终报价 (${currencyText})`;
      document.getElementById('resultFinalQuote').textContent = formatCurrencyInteger(Math.round(parseFloat(document.getElementById('finalQuote').value) || 0), currency);
    }
    
    // 添加成本明细项
    function addCostDetail(container, label, value, isNegative = false, isTotal = false) {
      const li = document.createElement('li');
      li.className = `flex justify-between ${isTotal ? 'pt-2 border-t border-gray-100 font-medium' : ''}`;
      
      const spanLabel = document.createElement('span');
      spanLabel.className = 'text-gray-600';
      spanLabel.textContent = `${label}:`;
      
      const spanValue = document.createElement('span');
      spanValue.className = isNegative ? 'text-green-600' : isTotal ? 'text-primary' : 'text-gray-700';
      
      // 购置税和退税保留小数点后两位，其他取整数
      let displayValue;
      if (label === '购置税' || label === '退税') {
        displayValue = formatCurrency(parseFloat(value) || 0);
      } else {
        displayValue = formatCurrencyInteger(Math.round(parseFloat(value) || 0));
      }
      spanValue.textContent = displayValue;
      
      li.appendChild(spanLabel);
      li.appendChild(spanValue);
      container.appendChild(li);
    }
    
    // 初始化页面时设置默认值
    window.addEventListener('DOMContentLoaded', function() {
      // 设置手续费滑块默认值
      const serviceFeeRate = document.getElementById('serviceFeeRate');
      const serviceFeeRateValue = document.getElementById('serviceFeeRateValue');
      
      serviceFeeRate.value = '0.04';
      serviceFeeRateValue.textContent = '0.04';
      
      // 自动显示新车表单
      document.getElementById('newCarForm').classList.remove('hidden');
      document.getElementById('newCarForm').classList.add('animate-fadeIn');
      
      // 显示汇率区域
      document.getElementById('currencySection').classList.remove('hidden');
      
      // 自动获取美元汇率
      fetchExchangeRate('USD');
      
      // 设置默认主题（新车主题）
      switchToNewCarTheme();
      
      // 初始化主题系统
      initThemeSystem();
    });

    // 获取汇率
    function fetchExchangeRate(currency) {
      const exchangeRateInput = document.getElementById('exchangeRate');
      const exchangeRateLabel = document.getElementById('exchangeRateLabel');
      exchangeRateInput.value = '加载中...';
      
      // Open Exchange Rates API
      const appId = '9625bee048bd4599842279906b9ca677';
      fetch(`https://openexchangerates.org/api/latest.json?app_id=${appId}&symbols=USD,EUR,GBP,CNY`)
        .then(res => res.json())
        .then(data => {
          let rate = 0;
          if (currency === 'USD') {
            rate = data.rates.CNY / data.rates.USD;
          } else if (currency === 'EUR') {
            rate = data.rates.CNY / data.rates.EUR;
          } else if (currency === 'GBP') {
            rate = data.rates.CNY / data.rates.GBP;
          }
          
          // 标题显示原始汇率（小数点后两位）
          exchangeRateLabel.textContent = `汇率 实时基准：${rate.toFixed(2)}`;
          // 数值栏显示减去0.05后的汇率（小数点后两位）
          exchangeRateInput.value = (rate - 0.05).toFixed(2);
          calculateFinalQuote();
        })
        .catch(() => {
          exchangeRateInput.value = '';
          exchangeRateLabel.textContent = '汇率 实时基准：获取失败';
          alert('汇率获取失败，请稍后重试');
        });
    }

    // 车型搜索功能
    let searchTimeout;
    const carModelInput = document.getElementById('carModel');
    const carSearchResults = document.getElementById('carSearchResults');
    
    // 监听车型名称输入
    carModelInput.addEventListener('input', function() {
      const keyword = this.value.trim();
      
      // 清除之前的定时器
      clearTimeout(searchTimeout);
      
      // 隐藏搜索结果
      carSearchResults.classList.add('hidden');
      
      if (keyword.length >= 2) {
        // 延迟搜索，避免频繁请求
        searchTimeout = setTimeout(() => {
          searchCarModel(keyword);
        }, 500);
      }
    });
    
    // 搜索车型
    async function searchCarModel(keyword) {
      try {
        // 显示加载状态
        carSearchResults.innerHTML = '<div class="p-4 text-center text-gray-500">搜索中...</div>';
        carSearchResults.classList.remove('hidden');
        
        // 调用后端API
        const response = await fetch(`http://localhost:3000/api/search-car?keyword=${encodeURIComponent(keyword)}`);
        
        if (!response.ok) {
          throw new Error('搜索失败');
        }
        
        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
          displayCarResults(result.data);
        } else {
          // 尝试备用API
          await searchCarModelFallback(keyword);
        }
        
      } catch (error) {
        console.error('搜索车型失败:', error);
        // 使用备用方案
        await searchCarModelFallback(keyword);
      }
    }
    
    // 备用搜索方案
    async function searchCarModelFallback(keyword) {
      try {
        const response = await fetch(`http://localhost:3000/api/search-car-fallback?keyword=${encodeURIComponent(keyword)}`);
        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
          displayCarResults(result.data);
        } else {
          carSearchResults.innerHTML = '<div class="p-4 text-center text-gray-500">未找到相关车型</div>';
        }
      } catch (error) {
        carSearchResults.innerHTML = '<div class="p-4 text-center text-gray-500">搜索服务暂时不可用</div>';
      }
    }
    
    // 显示搜索结果
    function displayCarResults(cars) {
      carSearchResults.innerHTML = '';
      
      cars.forEach(car => {
        const carItem = document.createElement('div');
        carItem.className = 'p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-custom';
        carItem.innerHTML = `
          <div class="flex items-center space-x-3">
            ${car.image ? `<img src="${car.image}" alt="${car.name}" class="w-12 h-8 object-cover rounded">` : '<div class="w-12 h-8 bg-gray-200 rounded flex items-center justify-center"><i class="fa fa-car text-gray-400"></i></div>'}
            <div class="flex-1">
              <div class="font-medium text-gray-900">${car.name}</div>
              <div class="text-sm text-gray-500">${car.price}</div>
            </div>
          </div>
        `;
        
        // 点击选择车型
        carItem.addEventListener('click', () => {
          carModelInput.value = car.name;
          carSearchResults.classList.add('hidden');
          
          // 如果价格包含数字，自动填充指导价
          const priceMatch = car.price.match(/(\d+(?:\.\d+)?)/);
          if (priceMatch) {
            const price = parseFloat(priceMatch[1]);
            if (price > 0) {
              document.getElementById('guidePrice').value = Math.round(price * 10000); // 转换为元
            }
          }
        });
        
        carSearchResults.appendChild(carItem);
      });
      
      carSearchResults.classList.remove('hidden');
    }
    
    // 点击其他地方隐藏搜索结果
    document.addEventListener('click', function(event) {
      if (!carModelInput.contains(event.target) && !carSearchResults.contains(event.target)) {
        carSearchResults.classList.add('hidden');
      }
    });
  </script>

  <script>
    // 车型名称智能搜索（只fetch一次，后续本地筛选，带图片）
    (function() {
      const input = document.getElementById('carModel');
      const resultBox = document.getElementById('carSearchResults');
      const guidePriceInput = document.getElementById('guidePrice');
      let carData = [];
      let lastResults = [];
      let loading = true;
      let fetchFailed = false;

      // 只fetch一次
      function loadData() {
        loading = true;
        resultBox.innerHTML = '<div class="px-4 py-2 text-gray-400">正在加载...</div>';
        resultBox.classList.remove('hidden');
        fetch('https://car-quote-zeta.vercel.app/api/cars')
          .then(res => res.json())
          .then(data => {
            carData = data;
            loading = false;
            fetchFailed = false;
            resultBox.classList.add('hidden');
          })
          .catch(() => {
            loading = false;
            fetchFailed = true;
            resultBox.innerHTML = '<div class="px-4 py-2 text-red-500">搜索服务不可用</div>';
            resultBox.classList.remove('hidden');
          });
      }
      loadData();

      // 搜索并显示结果
      function showResults(keyword) {
        if (loading) {
          resultBox.innerHTML = '<div class="px-4 py-2 text-gray-400">正在加载...</div>';
          resultBox.classList.remove('hidden');
          return;
        }
        if (fetchFailed) {
          resultBox.innerHTML = '<div class="px-4 py-2 text-red-500">搜索服务不可用</div>';
          resultBox.classList.remove('hidden');
          return;
        }
        resultBox.innerHTML = '';
        if (!keyword) {
          resultBox.classList.add('hidden');
          return;
        }
        // 模糊搜索，忽略大小写
        lastResults = carData.filter(car => car.carName && car.carName.toLowerCase().includes(keyword.toLowerCase()));
        if (lastResults.length === 0) {
          resultBox.innerHTML = '<div class="px-4 py-2 text-gray-400">无匹配车型</div>';
          resultBox.classList.remove('hidden');
          return;
        }
        lastResults.slice(0, 20).forEach((car, idx) => {
          const div = document.createElement('div');
          div.className = 'flex items-center px-4 py-2 cursor-pointer hover:bg-gray-50 border-b last:border-b-0';
          // 车型图片
          const img = document.createElement('img');
          img.src = car.brandImage || 'https://via.placeholder.com/40x28?text=No+Img';
          img.alt = car.carName;
          img.className = 'w-10 h-7 object-cover rounded mr-3 flex-shrink-0';
          div.appendChild(img);
          // 车型文字
          const text = document.createElement('span');
          text.textContent = car.carName + ' - ' + car.configName;
          // 指导价
          if (car.price) {
            const priceSpan = document.createElement('span');
            priceSpan.textContent = '  ' + car.price;
            priceSpan.className = 'ml-2 text-gray-500';
            div.appendChild(priceSpan);
          }
          div.dataset.idx = idx;
          div.onmousedown = function(e) {
            e.preventDefault(); // 防止失焦
            input.value = car.carName + ' - ' + car.configName;
            // 自动填充指导价，支持"万"单位
            if (guidePriceInput && car.price) {
              let priceNum = '';
              if (car.price.includes('万')) {
                priceNum = parseFloat(car.price) * 10000;
              } else {
                priceNum = parseFloat(car.price.replace(/[^\d.]/g, ''));
              }
              guidePriceInput.value = priceNum ? Math.round(priceNum) : '';
            }
            resultBox.classList.add('hidden');
          };
          resultBox.appendChild(div);
        });
        resultBox.classList.remove('hidden');
      }

      // 输入监听
      input.addEventListener('input', function() {
        showResults(this.value.trim());
      });

      // 失焦隐藏（用mousedown防止点击时提前隐藏）
      input.addEventListener('blur', function() {
        setTimeout(() => resultBox.classList.add('hidden'), 200);
      });
      resultBox.addEventListener('mousedown', function(e) {
        e.preventDefault();
      });
      // 聚焦时如果有内容则显示
      input.addEventListener('focus', function() {
        if (input.value.trim()) {
          showResults(input.value.trim());
        }
      });
    })();
  </script>
</body>
</html>
